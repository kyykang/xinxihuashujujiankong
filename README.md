# 信息化运维监控系统

一个基于 Python Flask 的企业级运维监控系统，支持服务器、应用、数据库、存储和业务指标的全方位监控。

## 功能特性

### 📊 多类型监控
- **服务器监控**：CPU、内存、磁盘使用率，支持本地和远程服务器（SSH）
- **应用监控**：HTTP/HTTPS 服务可用性和响应时间
- **数据库监控**：MySQL 数据库连接状态
- **存储监控**：磁盘空间使用情况
- **业务指标监控**：自定义 SQL 查询监控业务数据

### 🎨 可视化仪表板
- 实时图表展示（Chart.js）
- 服务器资源使用率柱状图
- 应用和数据库状态列表
- 自动刷新（30秒）和手动刷新
- 响应式设计，支持移动端

### 🔔 告警功能
- 可配置的告警阈值
- 企业微信推送（可选）
- 告警历史记录

### ⚙️ 灵活配置
- Web 界面管理监控目标
- 支持启用/禁用监控项
- 连接测试功能
- 时区配置（默认 Asia/Shanghai）

### 🚀 性能优化
- 并行执行监控任务（线程池）
- 优化的超时设置
- 快速响应（本地监控 <0.01秒）

## 系统要求

- Python 3.7+
- macOS / Linux
- 2GB+ RAM
- 支持 SSH 的远程服务器（可选）

## 快速开始

### 1. 安装依赖

```bash
pip3 install -r requirements.txt
```

### 2. 初始化数据库

数据库会在首次运行时自动创建。

### 3. 启动系统

```bash
python3 app.py
```

系统将在 `http://localhost:8080` 启动。

### 4. 访问系统

打开浏览器访问：
- 监控仪表板：http://localhost:8080/dashboard
- 监控目标管理：http://localhost:8080/targets
- 告警记录：http://localhost:8080/alerts
- 系统配置：http://localhost:8080/config

## 配置说明

### 监控目标配置

#### 本地服务器监控
1. 点击"添加监控目标"
2. 选择类型：服务器监控
3. 选择：本地服务器
4. 配置监控项（CPU、内存、磁盘）

#### 远程服务器监控
1. 选择类型：服务器监控
2. 选择：远程服务器
3. 填写服务器信息：
   - 服务器地址
   - SSH 端口（默认 22）
   - 用户名
   - 认证方式（密码或SSH密钥）
4. 点击"测试连接"验证配置
5. 保存

#### 应用监控
1. 选择类型：应用监控
2. 填写 URL 地址（如：http://example.com）
3. 测试连接后保存

#### 数据库监控
1. 选择类型：数据库监控
2. 填写数据库连接信息
3. 测试连接后保存

### 多类型监控配置

一个服务器需要监控多种类型时，建议使用命名规范：
- `[服务器名] - 服务器资源`
- `[服务器名] - Web应用`
- `[服务器名] - MySQL数据库`

详见：[多类型监控配置指南.md](多类型监控配置指南.md)

## 配置文件

### config.py

```python
CHECK_INTERVAL = 60  # 监控间隔（秒）
CPU_THRESHOLD = 80   # CPU告警阈值（%）
MEMORY_THRESHOLD = 80  # 内存告警阈值（%）
DISK_THRESHOLD = 80  # 磁盘告警阈值（%）
TIMEZONE = 'Asia/Shanghai'  # 时区
```

### 企业微信告警（可选）

在 `config.py` 中配置：
```python
WECHAT_WEBHOOK = 'your_webhook_url'
```

## 性能优化

系统已进行以下优化：
- ✅ 并行执行监控任务（10个并发）
- ✅ 优化超时时间（SSH: 5秒，HTTP: 3秒）
- ✅ 快速CPU检查（非阻塞模式）
- ✅ 本地监控几乎瞬时完成

性能测试结果：
- 10个监控目标：约5-10秒（并行执行）
- 本地监控：<0.01秒

详见：[性能优化说明.md](性能优化说明.md)

## 项目结构

```
.
├── app.py                  # Flask 应用主文件
├── config.py              # 配置文件
├── database.py            # 数据库初始化
├── monitors.py            # 监控逻辑
├── remote_monitor.py      # 远程服务器监控
├── scheduler.py           # 任务调度器
├── alerts.py              # 告警模块
├── utils.py               # 工具函数（时区转换等）
├── requirements.txt       # Python 依赖
├── templates/             # HTML 模板
│   ├── base.html
│   ├── dashboard.html
│   ├── targets.html
│   ├── alerts.html
│   └── config.html
└── monitoring.db          # SQLite 数据库（自动生成）
```

## 文档

- [使用说明.md](使用说明.md) - 详细使用指南
- [监控配置指南.md](监控配置指南.md) - 监控配置说明
- [多类型监控配置指南.md](多类型监控配置指南.md) - 多类型监控配置
- [性能优化说明.md](性能优化说明.md) - 性能优化详解
- [故障排查指南.md](故障排查指南.md) - 常见问题解决
- [时区配置说明.md](时区配置说明.md) - 时区配置
- [连接测试功能说明.md](连接测试功能说明.md) - 连接测试功能
- [图表显示问题修复.md](图表显示问题修复.md) - 图表问题修复
- [仪表板刷新功能说明.md](仪表板刷新功能说明.md) - 刷新功能说明

## 常见问题

### 1. 端口被占用

如果 5000 端口被占用（macOS AirPlay Receiver），系统默认使用 8080 端口。

### 2. 远程服务器连接失败

- 检查 SSH 端口是否正确
- 验证用户名和密码
- 确认防火墙设置
- 使用"测试连接"功能诊断

### 3. 图表不显示

- 强制刷新浏览器（Cmd+Shift+R 或 Ctrl+Shift+R）
- 检查浏览器控制台错误
- 确认监控任务已执行（查看控制台日志）

### 4. 系统刷新慢

- 检查远程服务器网络延迟
- 增加监控间隔（config.py 中的 CHECK_INTERVAL）
- 查看性能优化说明

## 技术栈

- **后端**：Python 3, Flask
- **数据库**：SQLite
- **前端**：Bootstrap 5, Chart.js 3
- **任务调度**：APScheduler
- **SSH连接**：Paramiko
- **系统监控**：psutil

## 开发计划

- [ ] 支持更多数据库类型（PostgreSQL, MongoDB）
- [ ] 邮件告警
- [ ] 钉钉告警
- [ ] 用户认证和权限管理
- [ ] 监控数据导出
- [ ] 移动端 App
- [ ] Docker 部署支持

## 贡献

欢迎提交 Issue 和 Pull Request！

## 许可证

MIT License

## 作者

康毅远 (kyykang)

## 更新日志

### v1.0.0 (2026-01-19)
- ✨ 初始版本发布
- ✅ 支持多类型监控
- ✅ 可视化仪表板
- ✅ 远程服务器监控
- ✅ 性能优化
- ✅ 连接测试功能
