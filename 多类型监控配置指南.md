# 一台服务器多类型监控配置指南

## 问题说明

当前系统中，一个监控目标只能配置一种监控类型。但实际上，一台服务器通常需要监控多个方面：
- 服务器资源（CPU、内存、磁盘）
- Web应用服务
- 数据库服务
- 缓存服务
- 业务指标

## 解决方案

**为同一台服务器创建多个监控目标，使用统一的命名规范进行管理。**

## 推荐命名规范

### 格式
```
[服务器名称] - [监控类型]
```

### 示例
```
Web服务器01 - 服务器资源
Web服务器01 - Nginx应用
Web服务器01 - MySQL数据库
Web服务器01 - Redis缓存
Web服务器01 - 订单业务指标
```

## 完整配置示例

### 场景：配置一台Web服务器的完整监控

假设有一台Web服务器：
- IP: 192.168.1.100
- 运行服务：Nginx、MySQL、Redis
- 需要监控：资源、应用、数据库、业务指标

### 步骤1：服务器资源监控

**监控目标配置：**
```
名称: Web服务器01 - 服务器资源
类型: 服务器监控
服务器类型: 远程服务器
服务器地址: 192.168.1.100
SSH端口: 22
用户名: root
密码: ********
监控项: ☑ CPU  ☑ 内存  ☑ 磁盘
```

**作用：** 监控服务器的CPU、内存、磁盘使用情况

### 步骤2：Nginx应用监控

**监控目标配置：**
```
名称: Web服务器01 - Nginx应用
类型: 应用监控
URL地址: http://192.168.1.100
```

**作用：** 监控Nginx服务是否在线，响应时间

### 步骤3：MySQL数据库监控

**监控目标配置：**
```
名称: Web服务器01 - MySQL数据库
类型: 数据库监控
主机地址: 192.168.1.100
端口: 3306
用户名: monitor
密码: ********
数据库名: mydb
```

**作用：** 监控MySQL数据库连接状态

### 步骤4：Redis监控（通过应用监控）

**监控目标配置：**
```
名称: Web服务器01 - Redis服务
类型: 应用监控
URL地址: http://192.168.1.100:6379
```

**注意：** 如果Redis没有HTTP接口，可以通过自定义脚本提供健康检查接口

### 步骤5：业务指标监控

**监控目标配置：**
```
名称: Web服务器01 - 订单业务指标
类型: 业务指标监控
数据库类型: MySQL
主机地址: 192.168.1.100
端口: 3306
用户名: monitor
密码: ********
数据库名: mydb
查询SQL: SELECT COUNT(*) FROM orders WHERE status='pending'
告警阈值: 100
```

**作用：** 监控待处理订单数量

## 配置结果

完成后，在监控目标列表中会看到：

```
ID  名称                              类型        状态
1   Web服务器01 - 服务器资源          服务器      启用
2   Web服务器01 - Nginx应用           应用        启用
3   Web服务器01 - MySQL数据库         数据库      启用
4   Web服务器01 - Redis服务           应用        启用
5   Web服务器01 - 订单业务指标        业务指标    启用
```

## 管理技巧

### 1. 使用搜索功能

在监控目标列表中搜索 "Web服务器01"，可以快速找到该服务器的所有监控项。

### 2. 统一命名前缀

所有相关的监控目标使用相同的前缀，便于：
- 快速识别
- 批量管理
- 分组查看

### 3. 添加详细说明

在名称中包含关键信息：
```
Web服务器01 (192.168.1.100) - Nginx (80端口)
Web服务器01 (192.168.1.100) - MySQL (3306端口)
```

### 4. 创建监控清单

维护一个文档记录每台服务器的监控配置：

```markdown
# 服务器监控清单

## Web服务器01 (192.168.1.100)
- [x] 服务器资源监控
- [x] Nginx应用监控
- [x] MySQL数据库监控
- [x] Redis服务监控
- [x] 订单业务指标
- [ ] 日志监控（待添加）

## 数据库服务器 (192.168.1.200)
- [x] 服务器资源监控
- [x] MySQL主库监控
- [x] MySQL从库监控
```

## 常见配置模板

### Web服务器标准配置

```
1. [服务器名] - 服务器资源
2. [服务器名] - Web应用 (Nginx/Apache)
3. [服务器名] - 数据库 (MySQL/PostgreSQL)
4. [服务器名] - 缓存 (Redis/Memcached)
```

### 数据库服务器标准配置

```
1. [服务器名] - 服务器资源
2. [服务器名] - MySQL主库
3. [服务器名] - MySQL从库
4. [服务器名] - 数据备份监控
```

### 应用服务器标准配置

```
1. [服务器名] - 服务器资源
2. [服务器名] - API服务
3. [服务器名] - 后台任务队列
4. [服务器名] - 业务指标
```

## 批量配置技巧

### 1. 复制配置

如果有多台相似的服务器：
1. 配置第一台服务器的所有监控
2. 记录配置参数
3. 为其他服务器创建相同的监控，只修改IP地址

### 2. 使用配置模板

创建一个配置模板文档：

```yaml
# Web服务器监控模板

服务器资源:
  类型: 服务器监控
  SSH端口: 22
  用户名: root
  监控项: CPU, 内存, 磁盘

Nginx应用:
  类型: 应用监控
  URL: http://{IP}

MySQL数据库:
  类型: 数据库监控
  端口: 3306
  用户名: monitor
  数据库: mydb
```

### 3. 分阶段配置

不需要一次性配置所有监控，可以分阶段：

**第一阶段：基础监控**
- 服务器资源监控

**第二阶段：服务监控**
- 应用监控
- 数据库监控

**第三阶段：业务监控**
- 业务指标监控
- 自定义监控

## 查看和管理

### 仪表板视图

在仪表板中，所有监控项会分别显示：
- 服务器资源图表
- 应用状态列表
- 数据库状态列表

### 告警管理

每个监控项独立产生告警：
```
[告警] Web服务器01 - 服务器资源: CPU使用率过高 85%
[告警] Web服务器01 - MySQL数据库: 连接失败
[告警] Web服务器01 - 订单业务指标: 待处理订单超过阈值 150
```

### 详情查看

点击每个监控目标的"详情"按钮，可以查看该监控项的：
- 历史趋势
- 监控数据
- 告警记录

## 优化建议

### 1. 合理设置监控间隔

- 关键服务：30-60秒
- 一般服务：60-120秒
- 业务指标：120-300秒

### 2. 设置合适的告警阈值

根据实际情况调整：
- CPU: 70-90%
- 内存: 80-90%
- 磁盘: 80-90%

### 3. 定期检查和优化

- 每周检查告警记录
- 调整不合理的阈值
- 删除不需要的监控项
- 添加新的监控需求

## 未来改进

系统将来会支持：

1. **快速配置向导**
   - 一次性配置一台服务器的所有监控
   - 自动生成监控目标

2. **分组显示**
   - 按服务器分组显示监控项
   - 折叠/展开功能

3. **监控模板**
   - 预设常用配置模板
   - 一键应用模板

4. **批量操作**
   - 批量启用/禁用
   - 批量修改配置

## 总结

虽然当前系统一个监控目标只能配置一种类型，但通过：
- ✅ 统一的命名规范
- ✅ 为同一服务器创建多个监控目标
- ✅ 维护监控清单文档

可以有效地实现一台服务器的多类型监控。

**关键点：**
1. 使用 `[服务器名] - [监控类型]` 的命名格式
2. 为每种监控需求创建独立的监控目标
3. 保持配置的一致性和规范性
4. 定期检查和优化监控配置

---

**提示**：如果你需要监控很多服务器，建议创建一个配置清单文档，记录每台服务器的监控配置，便于管理和维护。
