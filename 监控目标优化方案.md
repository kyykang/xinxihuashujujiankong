# 监控目标优化方案

## 当前问题

现在添加一个监控目标只能实现一个监控类型，但实际上一个服务器往往需要监控多种类型：
- 服务器资源（CPU、内存、磁盘）
- 运行的应用（HTTP服务）
- 数据库服务
- 存储空间
- 业务指标

## 解决方案

### 方案一：快速方案（推荐）

**保持现有数据结构，改进使用方式**

#### 实现方式

1. **批量添加功能**
   - 添加"快速配置服务器"功能
   - 一次性为一台服务器创建多个监控目标
   - 自动命名：如 "Web服务器01-资源"、"Web服务器01-应用"、"Web服务器01-数据库"

2. **分组显示**
   - 在监控目标列表中按服务器分组
   - 可以折叠/展开每个服务器的监控项
   - 便于管理和查看

3. **模板功能**
   - 预设常用监控组合
   - 如：Web服务器模板（资源+应用+数据库）
   - 一键应用模板

#### 优点
- ✅ 不需要修改数据库结构
- ✅ 实现简单快速
- ✅ 向后兼容
- ✅ 用户容易理解

#### 缺点
- ⚠️ 会产生多个监控目标记录
- ⚠️ 需要手动管理关联关系

### 方案二：完整方案

**重构数据结构，采用主机-监控项模型**

#### 数据结构

```
监控主机 (monitor_hosts)
├── 主机信息（名称、类型、连接配置）
└── 监控项 (monitor_items)
    ├── 服务器资源监控
    ├── 应用监控
    ├── 数据库监控
    └── 业务指标监控
```

#### 实现方式

1. **两级管理**
   - 第一级：管理监控主机
   - 第二级：管理该主机的监控项

2. **统一连接配置**
   - SSH连接信息在主机级别配置
   - 各监控项共享连接配置

3. **灵活组合**
   - 可以为一个主机添加任意数量的监控项
   - 每个监控项独立配置和启用/禁用

#### 优点
- ✅ 结构清晰，逻辑合理
- ✅ 避免重复配置连接信息
- ✅ 便于批量管理
- ✅ 扩展性好

#### 缺点
- ⚠️ 需要重构数据库
- ⚠️ 需要数据迁移
- ⚠️ 开发工作量大
- ⚠️ 可能影响现有功能

## 推荐实现：方案一的改进版

### 实现步骤

#### 1. 添加"快速配置"功能

在监控目标页面添加"快速配置服务器"按钮，弹出向导式界面：

**步骤1：基本信息**
```
服务器名称: [Web服务器01]
服务器类型: [远程服务器]
```

**步骤2：连接配置**
```
服务器地址: [192.168.1.100]
SSH端口: [22]
用户名: [root]
密码: [********]
```

**步骤3：选择监控项**
```
☑ 服务器资源监控 (CPU、内存、磁盘)
☑ 应用监控
  └ URL: [http://192.168.1.100]
☑ 数据库监控
  └ 端口: [3306]
  └ 数据库: [mydb]
☐ 存储监控
☐ 业务指标监控
```

**步骤4：确认创建**
```
将创建以下监控目标：
1. Web服务器01 - 服务器资源
2. Web服务器01 - 应用服务
3. Web服务器01 - MySQL数据库
```

#### 2. 改进监控目标列表

**分组显示：**
```
📁 Web服务器01 (3个监控项)
  ├─ 🖥️ 服务器资源 [正常]
  ├─ 🌐 应用服务 [正常]
  └─ 🗄️ MySQL数据库 [正常]

📁 数据库服务器 (2个监控项)
  ├─ 🖥️ 服务器资源 [正常]
  └─ 🗄️ MySQL数据库 [正常]

📄 独立监控项
  └─ 🌐 公司官网 [正常]
```

#### 3. 添加标签功能

为监控目标添加标签字段，用于分组：

```sql
ALTER TABLE monitor_targets ADD COLUMN tags TEXT;
```

标签示例：
- `server:web01` - 属于 web01 服务器
- `env:production` - 生产环境
- `team:backend` - 后端团队

#### 4. 批量操作

- 批量启用/禁用
- 批量删除
- 批量导出配置

### 使用示例

#### 场景1：配置一台新的Web服务器

**传统方式（需要4次操作）：**
1. 添加服务器资源监控
2. 添加Nginx应用监控
3. 添加MySQL数据库监控
4. 添加Redis监控

**快速配置（1次操作）：**
1. 点击"快速配置服务器"
2. 填写服务器信息
3. 勾选需要的监控项
4. 一键创建

#### 场景2：查看某台服务器的所有监控

**传统方式：**
- 在列表中逐个查找

**改进方式：**
- 点击服务器分组
- 查看该服务器的所有监控项
- 统一管理

## 实现优先级

### 第一阶段（立即实现）

1. ✅ 添加标签字段
2. ✅ 改进命名规范（建议用户使用 "服务器名-监控类型" 格式）
3. ✅ 添加使用说明文档

### 第二阶段（短期）

1. 🔄 实现快速配置向导
2. 🔄 实现分组显示
3. 🔄 实现批量操作

### 第三阶段（长期）

1. 📋 考虑重构为主机-监控项模型
2. 📋 实现监控模板
3. 📋 实现配置导入/导出

## 临时解决方案

在实现完整功能之前，可以采用以下方式：

### 1. 命名规范

建议使用统一的命名格式：
```
[服务器名称] - [监控类型]

示例：
- Web服务器01 - 服务器资源
- Web服务器01 - Nginx应用
- Web服务器01 - MySQL数据库
- Web服务器01 - Redis缓存
```

### 2. 使用描述字段

虽然当前没有描述字段，但可以在名称中包含更多信息：
```
Web服务器01 (192.168.1.100) - 服务器资源
Web服务器01 (192.168.1.100) - Nginx (80端口)
Web服务器01 (192.168.1.100) - MySQL (3306端口)
```

### 3. 创建监控清单

手动维护一个监控清单文档：

```markdown
# 监控清单

## Web服务器01 (192.168.1.100)
- [x] 服务器资源监控
- [x] Nginx应用监控 (http://192.168.1.100)
- [x] MySQL数据库监控 (3306端口)
- [ ] Redis监控 (待添加)

## 数据库服务器 (192.168.1.200)
- [x] 服务器资源监控
- [x] MySQL主库监控
- [x] MySQL从库监控
```

## 用户反馈

如果你觉得这个改进很重要，我可以立即开始实现：

1. **快速方案**：添加标签和命名规范（30分钟）
2. **完整方案**：实现快速配置向导（2-3小时）
3. **终极方案**：重构为主机-监控项模型（1天）

请告诉我你希望采用哪种方案？
