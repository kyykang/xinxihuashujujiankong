# 监控配置指南

## 如何配置监控目标

访问系统后，点击左侧菜单的"监控目标"，然后点击"添加监控目标"按钮。

---

## 一、服务器监控配置

### 1. 本地服务器监控

**适用场景：** 监控运行本系统的服务器

**配置步骤：**
1. 名称：输入服务器名称（如：Web服务器01）
2. 类型：选择"服务器监控"
3. 服务器类型：选择"本地服务器"
4. 监控项：勾选需要监控的项目（CPU、内存、磁盘）
5. 点击"保存"

**示例：**
```
名称: 本地Web服务器
类型: 服务器监控
服务器类型: 本地服务器
监控项: ✓ CPU  ✓ 内存  ✓ 磁盘
```

---

### 2. 远程服务器监控（通过SSH）

**适用场景：** 监控其他Linux服务器

**前置要求：**
- 目标服务器已开启SSH服务
- 有SSH登录权限（密码或密钥）

**配置步骤：**
1. 名称：输入服务器名称（如：数据库服务器）
2. 类型：选择"服务器监控"
3. 服务器类型：选择"远程服务器"
4. 服务器地址：输入IP地址（如：192.168.1.100）
5. SSH端口：默认22
6. 用户名：SSH登录用户名（如：root）
7. 认证方式：
   - **密码认证**：直接输入SSH密码
   - **SSH密钥认证**：输入密钥文件路径（如：/root/.ssh/id_rsa）
8. 磁盘路径：要监控的磁盘路径（默认 /）
9. 进程名称（可选）：监控特定进程（如：nginx）
10. 监控项：勾选需要监控的项目
11. 点击"保存"

**示例1 - 使用密码认证：**
```
名称: 数据库服务器
类型: 服务器监控
服务器类型: 远程服务器
服务器地址: 192.168.1.100
SSH端口: 22
用户名: root
认证方式: 密码
密码: ********
磁盘路径: /
进程名称: mysqld
监控项: ✓ CPU  ✓ 内存  ✓ 磁盘
```

**示例2 - 使用SSH密钥：**
```
名称: 应用服务器
类型: 服务器监控
服务器类型: 远程服务器
服务器地址: 10.0.0.50
SSH端口: 22
用户名: ubuntu
认证方式: SSH密钥
SSH密钥文件路径: /root/.ssh/app_server_key
磁盘路径: /data
进程名称: java
监控项: ✓ CPU  ✓ 内存  ✓ 磁盘
```

---

## 二、存储监控配置

**适用场景：** 监控特定存储路径的使用情况

**配置步骤：**
1. 名称：输入存储名称（如：数据盘）
2. 类型：选择"存储监控"
3. 存储路径：输入要监控的路径（如：/data）
4. 点击"保存"

**示例：**
```
名称: 数据存储
类型: 存储监控
存储路径: /data
```

---

## 三、应用监控配置

**适用场景：** 监控Web应用或API服务的可用性

**配置步骤：**
1. 名称：输入应用名称（如：官网）
2. 类型：选择"应用监控"
3. URL地址：输入完整的URL（如：http://example.com）
4. 点击"保存"

**示例：**
```
名称: 公司官网
类型: 应用监控
URL地址: https://www.example.com
```

```
名称: API服务
类型: 应用监控
URL地址: http://api.example.com/health
```

---

## 四、数据库监控配置

**适用场景：** 监控MySQL数据库连接状态

**配置步骤：**
1. 名称：输入数据库名称（如：主数据库）
2. 类型：选择"数据库监控"
3. 主机地址：数据库服务器IP（如：192.168.1.100）
4. 端口：MySQL端口（默认3306）
5. 用户名：数据库用户名
6. 密码：数据库密码
7. 数据库名：要连接的数据库（可选）
8. 点击"保存"

**示例：**
```
名称: 生产数据库
类型: 数据库监控
主机地址: 192.168.1.100
端口: 3306
用户名: monitor_user
密码: ********
数据库名: production_db
```

---

## 五、业务指标监控配置

**适用场景：** 监控业务数据，如订单数量、用户数等

**配置步骤：**
1. 名称：输入指标名称（如：待处理订单数）
2. 类型：选择"业务指标监控"
3. 数据库类型：选择MySQL或SQL Server
4. 主机地址：数据库服务器IP
5. 端口：数据库端口
6. 用户名：数据库用户名
7. 密码：数据库密码
8. 数据库名：数据库名称
9. 查询SQL：输入查询语句（必须返回单个数值）
10. 告警阈值：超过此值时触发告警（可选）
11. 点击"保存"

**示例1 - 监控待处理订单：**
```
名称: 待处理订单数
类型: 业务指标监控
数据库类型: MySQL
主机地址: 192.168.1.100
端口: 3306
用户名: monitor_user
密码: ********
数据库名: order_db
查询SQL: SELECT COUNT(*) FROM orders WHERE status='pending'
告警阈值: 100
```

**示例2 - 监控今日注册用户：**
```
名称: 今日注册用户数
类型: 业务指标监控
数据库类型: MySQL
主机地址: 192.168.1.100
端口: 3306
用户名: monitor_user
密码: ********
数据库名: user_db
查询SQL: SELECT COUNT(*) FROM users WHERE DATE(created_at) = CURDATE()
告警阈值: 1000
```

---

## 六、系统配置

访问"系统配置"页面，可以配置：

### 1. 监控配置
- **检查间隔**：多久执行一次监控检查（默认60秒）

### 2. 告警阈值
- **CPU使用率阈值**：超过此值触发告警（默认80%）
- **内存使用率阈值**：超过此值触发告警（默认80%）
- **磁盘使用率阈值**：超过此值触发告警（默认80%）
- **存储使用率阈值**：超过此值触发告警（默认80%）

### 3. 企业微信配置
- **Webhook地址**：企业微信机器人的Webhook URL

**获取企业微信Webhook：**
1. 在企业微信群聊中，点击右上角"..."
2. 选择"群机器人" → "添加机器人"
3. 设置机器人名称，复制Webhook地址
4. 将地址粘贴到系统配置中

**Webhook格式示例：**
```
https://qyapi.weixin.qq.com/cgi-bin/webhook/send?key=xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx
```

---

## 常见问题

### Q1: 远程服务器连接失败？
**检查项：**
- 服务器IP地址是否正确
- SSH端口是否正确（默认22）
- 用户名和密码/密钥是否正确
- 监控系统服务器能否访问目标服务器（防火墙规则）
- 目标服务器SSH服务是否运行

### Q2: 如何使用SSH密钥认证？
1. 在监控系统服务器上生成密钥对：`ssh-keygen -t rsa`
2. 将公钥复制到目标服务器：`ssh-copy-id user@target-server`
3. 在配置中填写私钥文件路径（通常是 ~/.ssh/id_rsa）

### Q3: 业务指标SQL查询要求？
- 查询必须返回单个数值
- 建议添加索引优化查询性能
- 避免复杂的JOIN和子查询
- 查询超时时间为5秒

### Q4: 告警没有推送到企业微信？
**检查项：**
- Webhook地址是否正确配置
- 企业微信机器人是否被禁用
- 查看系统日志是否有错误信息

---

## 最佳实践

1. **合理设置监控间隔**：根据业务重要性调整，重要服务可设置30秒
2. **分级告警**：不同服务器设置不同的告警阈值
3. **监控关键进程**：为重要服务配置进程监控
4. **定期检查**：定期查看告警记录，优化阈值设置
5. **安全性**：使用SSH密钥认证代替密码认证
6. **权限最小化**：为监控创建专用的只读数据库用户

---

## 技术支持

如有问题，请查看系统日志或联系管理员。
